<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">

  <!-- Titre -->
  <title>PSH SUP â€“ Vie du campus</title>

  <!-- Viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- PWA â€“ Mobile -->
  <meta name="theme-color" content="#b23a2c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="PSH SUP">

  <!-- Manifest -->
  <link rel="manifest" href="/manifest.json">

  <!-- IcÃ´nes -->
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512.png">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>


<body>

<!-- HEADER -->
<header class="header">
  <h1>Demande de rÃ©servation de salle</h1>
  <p>Vous avez besoin d'une salle merci de complÃ©ter le formulaire ci-dessous. Nous rÃ©pondrons Ã  votre demande dans la limite des salles disponibles</p>
</header>

<!-- CONTENU -->
<main class="page">

  <div class="card">

    <h2 style="margin-bottom:1rem;">ğŸ—“ï¸ Nouvelle rÃ©servation</h2>

    <form id="reservationForm">

  <label>Salle</label>
  <select id="salleSelect" required
    style="width:100%;margin-bottom:0.6rem;padding:0.6rem;">
    <option value="">Choisir une salle</option>
  </select>

  <label>DÃ¢te</label>
  <input type="date" id="date" required
    style="width:100%;margin-bottom:0.6rem;padding:0.6rem;">

  <label>Heure de dÃ©but de rÃ©servation</label>
  <input type="time" id="heureDebut" required
    style="width:100%;margin-bottom:0.6rem;padding:0.6rem;">

  <label>Heure de fin de rÃ©servation</label>
  <input type="time" id="heureFin" required
    style="width:100%;margin-bottom:0.6rem;padding:0.6rem;">

  <label>Nom et PrÃ©nom</label>
  <input type="text" id="nomPrenom" required
    placeholder="Nom et prÃ©nom"
    style="width:100%;margin-bottom:0.6rem;padding:0.6rem;">

  <label>Mail</label>
  <input type="email" id="email" required
    placeholder="Adresse email"
    style="width:100%;margin-bottom:0.6rem;padding:0.6rem;">

  <label>Motif</label>
  <textarea id="motif"
    placeholder="Motif de la demande (optionnel)"
    style="width:100%;margin-bottom:0.8rem;padding:0.6rem;">
  </textarea>

  <button type="submit" class="btn-primary" style="width:100%;">
    Envoyer la demande
  </button>

</form>

<p id="reservationMessage"
   style="margin-top:0.8rem;font-size:0.85rem;"></p>


    <p id="reservationMessage"
       style="margin-top:0.8rem;font-size:0.85rem;"></p>

  </div>

</main>

<!-- FOOTER -->
<footer class="footer">
  Â© PSH SUP â€“ Vie du campus â€“ 2026
</footer>

<!-- NAVIGATION BASSE -->
<nav class="bottom-nav">
  <a href="index.html" class="nav-item">
    <span>ğŸ </span><small>Accueil</small>
  </a>
  <a href="actualites.html" class="nav-item">
    <span>ğŸ“°</span><small>Actus</small>
  </a>
  <a href="evenements.html" class="nav-item">
    <span>ğŸ“…</span><small>Events</small>
  </a>
  <a href="salles.html" class="nav-item">
    <span>ğŸ«</span><small>Salles</small>
  </a>
    <a href="contact-admin.html" class="nav-item">
    <span>ğŸ¢</span><small>Admin</small>
  </a>
</nav>

<script>
/* ===============================
   ğŸ” SUPABASE CONFIG
=============================== */
const SUPABASE_URL = "https://wqjzgpxcudobdbhtatgw.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_RQyY6vwKpcQdlRVFvDVD-A_YybqqTS_";

const supabaseClient = supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

/* ===============================
   ğŸ”’ AUTH GUARD
=============================== */
supabaseClient.auth.getSession().then(({ data }) => {
  if (!data.session) {
    window.location.href = "login.html";
  }
});

/* ===============================
   ğŸ« CHARGER LES SALLES
=============================== */
async function loadSalles() {
  const { data, error } = await supabaseClient
    .from("salles")
    .select("id, numero, capacite")
    .order("numero", { ascending: true });

  if (error) {
    console.error("Erreur chargement salles :", error);
    return;
  }

  const select = document.getElementById("salleSelect");
  select.innerHTML = '<option value="">Choisir une salle</option>';

  data.forEach(salle => {
    const option = document.createElement("option");
    option.value = salle.id;
    option.textContent = `Salle ${salle.numero} â€” ${salle.capacite} places`;
    select.appendChild(option);
  });
}

/* ===============================
   â• ENVOI RÃ‰SERVATION
=============================== */
document.getElementById("reservationForm").addEventListener("submit", async e => {
  e.preventDefault();

  const msg = document.getElementById("reservationMessage");
  msg.textContent = "";
  msg.style.color = "";

  const salleId = document.getElementById("salleSelect").value;
  const date = document.getElementById("date").value;
  const debut = document.getElementById("heureDebut").value;
  const fin = document.getElementById("heureFin").value;
  const nomPrenom = document.getElementById("nomPrenom").value.trim();
  const email = document.getElementById("email").value.trim();
  const motif = document.getElementById("motif").value.trim();

  const button = e.target.querySelector("button");
  button.disabled = true;
  button.textContent = "Envoi en cours...";

  /* âœ… VALIDATIONS */
  if (!salleId) {
    msg.textContent = "âŒ Veuillez sÃ©lectionner une salle";
    msg.style.color = "#b23a2c";
    button.disabled = false;
    button.textContent = "Envoyer la demande";
    return;
  }

  if (fin <= debut) {
    msg.textContent = "âŒ Lâ€™heure de fin doit Ãªtre aprÃ¨s lâ€™heure de dÃ©but";
    msg.style.color = "#b23a2c";
    button.disabled = false;
    button.textContent = "Envoyer la demande";
    return;
  }

  /* ğŸ•’ Construction dates UTC propres */
  const dateDebut = new Date(`${date}T${debut}:00`);
  const dateFin = new Date(`${date}T${fin}:00`);

  const { error } = await supabaseClient
    .from("reservations")
    .insert({
      salle_id: salleId,
      date_debut: dateDebut.toISOString(),
      date_fin: dateFin.toISOString(),
      nom_prenom: nomPrenom,
      email: email,
      motif: motif || null
    });

  button.disabled = false;
  button.textContent = "Envoyer la demande";

  if (error) {
    console.error("SUPABASE ERROR:", error);
    msg.textContent = "âŒ Salle dÃ©jÃ  rÃ©servÃ©e ou donnÃ©es invalides";
    msg.style.color = "#b23a2c";
  } else {
    msg.textContent = "âœ… Demande envoyÃ©e avec succÃ¨s";
    msg.style.color = "green";
    e.target.reset();
  }
});

/* ===============================
   ğŸš€ INIT
=============================== */
loadSalles();
</script>


</body>
</html>
	